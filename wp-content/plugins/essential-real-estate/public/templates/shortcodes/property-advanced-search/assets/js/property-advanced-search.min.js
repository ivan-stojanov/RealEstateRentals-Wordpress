var ERE_Property_Advanced_Search=ERE_Property_Advanced_Search||{};!function(e){"use strict";var t=ere_property_advanced_search_vars.ajax_url,a=ere_property_advanced_search_vars.price_is_slider,r=".ere-property-advanced-search";ERE_Property_Advanced_Search={init:function(){"1"==ere_property_advanced_search_vars.enable_filter_location&&(e(".ere-property-country-ajax",r).select2(),e(".ere-property-state-ajax",r).select2(),e(".ere-property-city-ajax",r).select2(),e(".ere-property-neighborhood-ajax",r).select2()),this.get_states_by_country(),e(".ere-property-country-ajax",r).on("change",function(){ERE_Property_Advanced_Search.get_states_by_country()}),this.get_cities_by_state(),e(".ere-property-state-ajax",r).on("change",function(){ERE_Property_Advanced_Search.get_cities_by_state()}),this.get_neighborhoods_by_city(),e(".ere-property-city-ajax",r).on("change",function(){ERE_Property_Advanced_Search.get_neighborhoods_by_city()}),e(".btn-status-filter",r).on("click",function(t){t.preventDefault();var a=e(this).data("value");e(this).parent().find("input").val(a),e(this).parent().find("button").removeClass("active"),e(this).addClass("active"),ERE_Property_Advanced_Search.change_price_on_status_change(a)}),e('select[name="status"]',r).on("change",function(t){t.preventDefault();var a=e(this).val();ERE_Property_Advanced_Search.change_price_on_status_change(a)}),this.execute_url_search(),e(".ere-sliderbar-filter.ere-sliderbar-price",r).on("register.again",function(){e(".ere-sliderbar-filter.ere-sliderbar-price",r).each(function(){var t=e(this);ERE_Property_Advanced_Search.set_slider_filter(t)})}),this.register_slider_filter(),this.set_slider_value(),e(".other-features-wrap .btn-other-features",r).on("click",function(t){t.preventDefault(),e(".other-features-list",r).slideToggle(),e(this).toggleClass("show"),1==e(this).hasClass("show")?(e('input[name="features-search"]',r).attr("value","1"),e(this).find("i").removeClass("fa-chevron-down"),e(this).find("i").addClass("fa-chevron-up")):(e('input[name="features-search"]',r).attr("value","0"),e(this).find("i").removeClass("fa-chevron-up"),e(this).find("i").addClass("fa-chevron-down"))})},get_states_by_country:function(){var a=e(".ere-property-country-ajax",r);if(a.length){var i=a.val();e.ajax({type:"POST",url:t,data:{action:"ere_get_states_by_country_ajax",country:i,type:1,is_slug:"1"},success:function(t){e(".ere-property-state-ajax",r).html(t);var a=e(".ere-property-state-ajax",r).attr("data-selected");void 0!==a&&e(".ere-property-state-ajax",r).val(a)}})}},get_cities_by_state:function(){var a=e(".ere-property-state-ajax",r);if(a.length){var i=a.val();e.ajax({type:"POST",url:t,data:{action:"ere_get_cities_by_state_ajax",state:i,type:1,is_slug:"1"},success:function(t){e(".ere-property-city-ajax",r).html(t);var a=e(".ere-property-city-ajax",r).attr("data-selected");void 0!==a&&e(".ere-property-city-ajax",r).val(a)}})}},get_neighborhoods_by_city:function(){var a=e(".ere-property-city-ajax",r);if(a.length){var i=a.val();e.ajax({type:"POST",url:t,data:{action:"ere_get_neighborhoods_by_city_ajax",city:i,type:1,is_slug:"1"},success:function(t){e(".ere-property-neighborhood-ajax",r).html(t);var a=e(".ere-property-neighborhood-ajax",r).attr("data-selected");void 0!==a&&e(".ere-property-neighborhood-ajax",r).val(a)}})}},execute_url_search:function(){e(".ere-advanced-search-btn",r).on("click",function(t){t.preventDefault();var a=e(this).closest(".search-properties-form"),r=a.data("href"),i=[],n="?";if(-1!==r.indexOf("?")&&(n="&"),e(".search-field",a).each(function(){var t=e(this),a=t.attr("name"),r=t.val();r!=t.data("default-value")&&(i[a]=r)}),e(".ere-sliderbar-filter",a).each(function(){var t=e(this),a=t.find(".min-input-request").attr("name"),r=t.find(".max-input-request").attr("name"),n=t.find(".min-input-request").val(),s=t.find(".max-input-request").val(),c=t.data("min-default"),o=t.data("max-default");n==c&&s==o||(i[a]=n,i[r]=s)}),void 0!==i["features-search"]){var s="";e('[name="other_features"]',a).each(function(){var t=e(this),a=t.attr("value");t.is(":checked")&&(s+=a+";")}),""!==s&&(s=s.substring("0",s.length-1),i.other_features=s)}if(i!==[])for(var c in i)i.hasOwnProperty(c)&&(n+=c+"="+i[c]+"&");n=n.substring("0",n.length-1),window.location.href=r+n})},set_slider_filter:function(e){var t,a,r=e,i=parseInt(r.attr("data-min-default")),n=parseInt(r.attr("data-max-default")),s=r.attr("data-min"),c=r.attr("data-max");r.find(".sidebar-filter").slider({min:i,max:n,range:!0,values:[s,c],slide:function(e,i){t=i.values[0],a=i.values[1],r.attr("data-min",t),r.attr("data-max",a),r.find("input.min-input-request").attr("value",t),r.find("input.max-input-request").attr("value",a),r.find("span").hasClass("not-format")?(r.find("span.min-value").html(t),r.find("span.max-value").html(a)):(r.find("span.min-value:not(.not-format)").html(ERE.number_format(t)),r.find("span.max-value:not(.not-format)").html(ERE.number_format(a)))},stop:function(e,t){}})},register_slider_filter:function(){e(".ere-sliderbar-filter",r).each(function(){var t=e(this);ERE_Property_Advanced_Search.set_slider_filter(t)})},set_slider_value:function(){e(".ere-sliderbar-filter",r).each(function(){var t=e(this),a=t.attr("data-min-default"),r=t.attr("data-max-default"),i=t.attr("data-min"),n=t.attr("data-max"),s=(i-a)/(r-a)*100+"%",c=(n-i)/(r-a)*100+"%",o=(n-a)/(r-a)*100+"%";t.find(".ui-slider-range.ui-corner-all.ui-widget-header").css({left:s,width:c}),t.find(".ui-slider-handle.ui-corner-all.ui-state-default").css("left",s),t.find(".ui-slider-handle.ui-corner-all.ui-state-default:last-child").css("left",o)})},change_price_on_status_change:function(i){e.ajax({type:"POST",url:t,dataType:"json",data:{action:"ere_ajax_change_price_on_status_change",status:i,price_is_slider:a},success:function(t){t.slide_html?(e(".ere-sliderbar-price-wrap",r).html(t.slide_html),ERE_Property_Advanced_Search.register_slider_filter(),ERE_Property_Advanced_Search.set_slider_value()):(t.min_price_html&&e('select[name="min-price"]',r).html(t.min_price_html),t.max_price_html&&e('select[name="max-price"]',r).html(t.max_price_html))}})}},e(document).ready(function(){ERE_Property_Advanced_Search.init()})}(jQuery);