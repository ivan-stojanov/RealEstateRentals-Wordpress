var ERE_Property_Map_Search=ERE_Property_Map_Search||{};!function(e){"use strict";var t,a,r=ere_search_vars.ajax_url,i=ere_search_vars.price_is_slider,n=".ere-search-properties-map",s=[],o=!1,l=!0;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(l=!1,o=!0),ERE_Property_Map_Search={init:function(){"1"==ere_search_vars.enable_filter_location&&(e(".ere-property-country-ajax",n).select2(),e(".ere-property-state-ajax",n).select2(),e(".ere-property-city-ajax",n).select2(),e(".ere-property-neighborhood-ajax",n).select2()),this.full_screen(),this.get_states_by_country(),e(".ere-property-country-ajax",n).on("change",function(){ERE_Property_Map_Search.get_states_by_country()}),this.get_cities_by_state(),e(".ere-property-state-ajax",n).on("change",function(){ERE_Property_Map_Search.get_cities_by_state()}),this.get_neighborhoods_by_city(),e(".ere-property-city-ajax",n).on("change",function(){ERE_Property_Map_Search.get_neighborhoods_by_city()}),e(".btn-status-filter",n).on("click",function(t){t.preventDefault();var a=e(this).data("value");e(this).parent().find("input").val(a),e(this).parent().find("button").removeClass("active"),e(this).addClass("active"),ERE_Property_Map_Search.change_price_on_status_change(a)}),e('select[name="status"]',n).on("change",function(t){t.preventDefault();var a=e(this).val();ERE_Property_Map_Search.change_price_on_status_change(a)}),this.execute_url_search(),e(".ere-sliderbar-filter.ere-sliderbar-price",n).on("register.again",function(){e(".ere-sliderbar-filter.ere-sliderbar-price",n).each(function(){var t=e(this);ERE_Property_Map_Search.set_slider_filter(t)})}),this.register_slider_filter(),this.set_slider_value(),e(".other-features-wrap .btn-other-features",n).on("click",function(t){t.preventDefault(),e(".other-features-list",n).slideToggle(),e(this).toggleClass("show"),1==e(this).hasClass("show")?(e('input[name="features-search"]',n).attr("value","1"),e(this).find("i").removeClass("fa-chevron-down"),e(this).find("i").addClass("fa-chevron-up")):(e('input[name="features-search"]',n).attr("value","0"),e(this).find("i").removeClass("fa-chevron-up"),e(this).find("i").addClass("fa-chevron-down")),ERE_Property_Map_Search.search_on_change()}),e(".ere-sliderbar-filter.ere-sliderbar-price",n).on("register.again",function(){e(".ere-sliderbar-filter.ere-sliderbar-price",n).each(function(){var t=e(this);ERE_Property_Map_Search.set_slider_filter(t)})}),e(".ere-search-status-tab .btn-status-filter",n).on("click",function(){e(this).parent().find("input").val(e(this).data("value")),e(this).parent().find("button").removeClass("active"),e(this).addClass("active")}),e('select[name="type"], select[name="bedrooms"],select[name="bathrooms"] , select[name="garage"], select[name="label"],input[name="address"],input[name="title"],input[name="property_identity"], select[name="min-price"], select[name="max-price"],select[name="min-area"], select[name="max-area"],select[name="min-land-area"], select[name="min-land-area"], select[name="city"], select[name="country"], select[name="state"], select[name="neighborhood"]',n).on("change",function(){ERE_Property_Map_Search.search_on_change()}),e('input[name="other_features"]',n).on("change",function(){ERE_Property_Map_Search.search_on_change()}),ERE_Property_Map_Search.search_properties("map_only")},get_states_by_country:function(){var t=e(".ere-property-country-ajax",n);if(t.length){var a=t.val();e.ajax({type:"POST",url:r,data:{action:"ere_get_states_by_country_ajax",country:a,type:1,is_slug:"1"},success:function(t){e(".ere-property-state-ajax",n).html(t);var a=e(".ere-property-state-ajax",n).attr("data-selected");void 0!==a&&e(".ere-property-state-ajax",n).val(a)}})}},get_cities_by_state:function(){var t=e(".ere-property-state-ajax",n);if(t.length){var a=t.val();e.ajax({type:"POST",url:r,data:{action:"ere_get_cities_by_state_ajax",state:a,type:1},success:function(t){e(".ere-property-city-ajax",n).html(t);var a=e(".ere-property-city-ajax",n).attr("data-selected");void 0!==a&&e(".ere-property-city-ajax",n).val(a)}})}},get_neighborhoods_by_city:function(){var t=e(".ere-property-city-ajax",n);if(t.length){var a=t.val();e.ajax({type:"POST",url:r,data:{action:"ere_get_neighborhoods_by_city_ajax",city:a,type:1,is_slug:"1"},success:function(t){e(".ere-property-neighborhood-ajax",n).html(t);var a=e(".ere-property-neighborhood-ajax",n).attr("data-selected");void 0!==a&&e(".ere-property-neighborhood-ajax",n).val(a)}})}},execute_url_search:function(){e(".ere-advanced-search-btn",n).on("click",function(t){t.preventDefault();var a=e(this).closest(".search-properties-form"),r=a.data("href"),i=[],n="?";if(-1!==r.indexOf("?")&&(n="&"),e(".search-field",a).each(function(){var t=e(this),a=t.attr("name"),r=t.val();r!=t.data("default-value")&&(i[a]=r)}),e(".ere-sliderbar-filter",a).each(function(){var t=e(this),a=t.find(".min-input-request").attr("name"),r=t.find(".max-input-request").attr("name"),n=t.find(".min-input-request").val(),s=t.find(".max-input-request").val(),o=t.data("min-default"),l=t.data("max-default");n==o&&s==l||(i[a]=n,i[r]=s)}),void 0!==i["features-search"]){var s="";e('[name="other_features"]',a).each(function(){var t=e(this),a=t.attr("value");t.is(":checked")&&(s+=a+";")}),""!==s&&(s=s.substring("0",s.length-1),i.other_features=s)}if(i!==[])for(var o in i)i.hasOwnProperty(o)&&(n+=o+"="+i[o]+"&");n=n.substring("0",n.length-1),window.location.href=r+n})},set_slider_filter:function(e){var t,a,r=e,i=parseInt(r.attr("data-min-default")),n=parseInt(r.attr("data-max-default")),s=r.attr("data-min"),o=r.attr("data-max");r.find(".sidebar-filter").slider({min:i,max:n,range:!0,values:[s,o],slide:function(e,i){t=i.values[0],a=i.values[1],r.attr("data-min",t),r.attr("data-max",a),r.find("input.min-input-request").attr("value",t),r.find("input.max-input-request").attr("value",a),r.find("span").hasClass("not-format")?(r.find("span.min-value").html(t),r.find("span.max-value").html(a)):(r.find("span.min-value:not(.not-format)").html(ERE.number_format(t)),r.find("span.max-value:not(.not-format)").html(ERE.number_format(a)))},stop:function(e,t){ERE_Property_Map_Search.search_on_change()}})},register_slider_filter:function(){e(".ere-sliderbar-filter",n).each(function(){var t=e(this);ERE_Property_Map_Search.set_slider_filter(t)})},set_slider_value:function(){e(".ere-sliderbar-filter",n).each(function(){var t=e(this),a=t.attr("data-min-default"),r=t.attr("data-max-default"),i=t.attr("data-min"),n=t.attr("data-max"),s=(i-a)/(r-a)*100+"%",o=(n-i)/(r-a)*100+"%",l=(n-a)/(r-a)*100+"%";t.find(".ui-slider-range.ui-corner-all.ui-widget-header").css({left:s,width:o}),t.find(".ui-slider-handle.ui-corner-all.ui-state-default").css("left",s),t.find(".ui-slider-handle.ui-corner-all.ui-state-default:last-child").css("left",l)})},change_price_on_status_change:function(t){e.ajax({type:"POST",url:r,dataType:"json",data:{action:"ere_ajax_change_price_on_status_change",status:t,price_is_slider:i},success:function(t){t.slide_html?(e(".ere-sliderbar-price-wrap",n).html(t.slide_html),ERE_Property_Map_Search.register_slider_filter(),ERE_Property_Map_Search.set_slider_value()):(t.min_price_html&&e('select[name="min-price"]',n).html(t.min_price_html),t.max_price_html&&e('select[name="max-price"]',n).html(t.max_price_html)),ERE_Property_Map_Search.search_on_change()}})},full_screen:function(){if(e(".ere-search-properties-map.style-vertical").length>0){var t=e(window).outerHeight(),a=e("#wpadminbar").outerHeight();null==a&&(a=0);var r=t-a-e("header").outerHeight()-e("footer").outerHeight()-e(".wpadminbar").outerHeight();e(".ere-search-properties-map.style-vertical .ere-map-search").css("height",r),e(".ere-search-properties-map.style-vertical .ere-map-search .ere-map-result").css("height",r),e(".col-scroll-vertical").css({height:r,"overflow-y":"scroll","overflow-x":"hidden"});var i=e(".owl-carousel",".list-property-result-ajax"),n=e(".property-item",i);i.trigger("destroy.owl.carousel"),i.css("opacity",1),i.imagesLoaded(function(){ERE.set_item_effect(n,"hide"),ERE_Carousel.owlCarousel(),n=e(".property-item",i),ERE.set_item_effect(n,"show")})}},search_on_change:function(){var t="map_only";e(".list-property-result-ajax",n).length>0&&(t="map_and_content"),ERE_Property_Map_Search.search_properties(t)},search_properties:function(i){var p,d,u,_,h,m,f,g,v,y,b,x,E,w,P,R,j,S,M,C,k=e(n);h=k.find('input[name="title"]').val(),w=k.find('input[name="address"]').val(),d=k.find('select[name="city"]').val(),f=k.find('select[name="type"]').val(),void 0==(m=k.find('select[name="status"]').val())&&(m=k.find('input[name="status"]').val()),g=k.find('select[name="bedrooms"]').val(),v=k.find('select[name="bathrooms"]').val(),e(".ere-sliderbar-price",k).length?(y=k.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-min"),b=k.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-max")):(y=k.find('select[name="min-price"]').val(),b=k.find('select[name="max-price"]').val()),e(".ere-sliderbar-area",k).length?(x=k.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-min"),E=k.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-max")):(x=k.find('select[name="min-area"]').val(),E=k.find('select[name="max-area"]').val()),e(".ere-sliderbar-land-area",k).length?(S=k.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-min"),M=k.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-max")):(S=k.find('select[name="min-land-area"]').val(),M=k.find('select[name="max-land-area"]').val()),u=k.find('select[name="state"]').val(),p=k.find('select[name="country"]').val(),_=k.find('select[name="neighborhood"]').val(),j=k.find('select[name="label"]').val(),P=k.find('select[name="garage"]').val(),C=k.find('input[name="property_identity"]').val(),"1"==k.find('input[name="features-search"]').val()&&(R="",k.find(".other-features-list input[type=checkbox]:checked").each(function(){R+=e(this).val()+";"}),""!=R&&(R=R.substring(0,R.length-1)));var L=e("#ere_security_search_map").val(),O=e(k).find(".ere-map-result").attr("id"),T=e("#"+O),I=ere_search_vars.googlemap_default_zoom,z=ere_search_vars.not_found,B=ere_search_vars.clusterIcon,H=ere_search_vars.google_map_style,q=ere_search_vars.pin_cluster_enable,A={zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},scrollwheel:!1,scroll:{x:e(window).scrollLeft(),y:e(window).scrollTop()},zoom:parseInt(I),mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:l,fullscreenControl:!0,fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}};a=new InfoBox({disableAutoPan:!0,maxWidth:310,alignBottom:!0,pixelOffset:new google.maps.Size(-140,-55),zIndex:null,closeBoxMargin:"0 0 -16px -16px",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1});e.ajax({dataType:"json",url:r,data:{action:"ere_property_search_ajax",title:h,address:w,country:p,state:u,city:d,neighborhood:_,type:f,status:m,bedrooms:g,bathrooms:v,min_price:y,max_price:b,min_area:x,max_area:E,label:j,garage:P,min_land_area:S,max_land_area:M,property_identity:C,features:R,search_type:i,ere_security_search_map:L},beforeSend:function(){T.parents("div.ere-search-properties-map").find("#ere-map-loading").fadeIn()},success:function(r){if("map_and_content"==i){var n=e(".owl-carousel",".list-property-result-ajax"),l=e(".list-property-result-ajax");if(n.empty(),!1===r.success)l.find(".title-result h2 .number-result").hide(),l.find(".title-result h2 .text-no-result").show(),l.find(".title-result h2 .text-result").hide();else{var p=e(".property-item",r.property_html);n.css("opacity",0),n.trigger("destroy.owl.carousel"),n.html(p),n.css("opacity",1),n.imagesLoaded(function(){ERE.set_item_effect(p,"hide"),ERE_Carousel.owlCarousel(),p=e(".property-item",n),ERE.set_item_effect(p,"show")}),"0"!=p.length&&(l.find(".title-result h2 .number-result").html(p.length),l.find(".title-result h2 .number-result").show(),l.find(".title-result h2 .text-no-result").hide(),l.find(".title-result h2 .text-result").show())}ERE.favorite(),ERE.tooltip(),ERE_Compare.register_event_compare()}if((t=new google.maps.Map(document.getElementById(O),A)).set("scrollwheel",!1),google.maps.event.trigger(t,"resize"),!0===r.success&&r.properties)var d=r.properties.length;if(1==d)var u=google.maps.event.addListener(t,"bounds_changed",function(e){this.setZoom(parseInt(I)),google.maps.event.removeListener(u)});if(""!==H){var _=JSON.parse(H);t.setOptions({styles:_})}var h,m,f=new google.maps.LatLng("","");if(t.setCenter(f),t.setZoom(parseInt(I)),google.maps.event.addListener(t,"tilesloaded",function(){e("#ere-map-loading").fadeOut()}),!0===r.success){for(var g=0;g<s.length;g++)s[g].setMap(null);s=[],h=r.properties,m=t,e.each(h,function(e,t){var r=new google.maps.LatLng(t.lat,t.lng),i={url:t.marker_icon,size:new google.maps.Size(44,60),scaledSize:new google.maps.Size(44,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(7,27)},n=new google.maps.Marker({position:r,map:m,icon:i,draggable:!1,animation:google.maps.Animation.DROP}),o=t.data?t.data.post_title:t.title,l="";""!=t.image_url&&void 0!==t.image_url||(l='style="display: none;"');var c,p=document.createElement("div");p.className="marker-content clearfix",p.innerHTML='<div class="marker-content-inner clearfix"><div class = "item-thumb" '+l+'><a href="'+t.url+'"><img src="'+t.image_url+'" alt="'+o+'" style="width: 100px;"></a></div><div class="item-body"><a href="'+t.url+'" class="title-marker">'+o+'</a><div class="price-marker">'+t.price+'</div><div class="address-marker"><i class="fa fa-map-marker"></i>'+t.address+"</div></div></div>",google.maps.event.addListener(n,"click",(c=n,function(){var e=100/Math.pow(2,m.getZoom())||0,t=m.getProjection(),r=c.getPosition(),i=t.fromLatLngToPoint(r),n=new google.maps.Point(i.x,i.y-e),s=t.fromPointToLatLng(n);m.setCenter(s),setTimeout(function(){a.setContent(p),a.open(m,c)},300)})),s.push(n)}),t.fitBounds(s.reduce(function(e,t){return e.extend(t.getPosition())},new google.maps.LatLngBounds)),google.maps.event.trigger(t,"resize"),"1"==q&&new MarkerClusterer(t,s,{gridSize:60,styles:[{url:B,width:48,height:48,textColor:"#fff"}]}),o||c()}else T.empty().html('<div class="map-notfound">'+z+"</div>");T.closest("div.ere-search-properties-map").find("#ere-map-loading").fadeOut("slow")},error:function(){T.closest("div.ere-search-properties-map").find("#ere-map-loading").fadeOut("slow")}})}};var c=function(){return e(".property-item",n).each(function(r){e(this).on("mouseenter",function(){t&&google.maps.event.trigger(s[r],"click")}),e(this).on("mouseleave",function(){a.open(null,null)})}),!1};e(document).ready(function(){ERE_Property_Map_Search.init()}),e(window).resize(function(){ERE_Property_Map_Search.full_screen()}),e(window).on("orientationchange",function(){ERE_Property_Map_Search.full_screen()})}(jQuery);