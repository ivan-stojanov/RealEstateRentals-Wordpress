var ERE_Property_Map_Search=ERE_Property_Map_Search||{};!function(e){"use strict";var a,t,r=ere_search_map_vars.ajax_url,i=ere_search_map_vars.price_is_slider,n=ere_search_map_vars.item_amount,s=".ere-search-map-properties",o=[],l=!1,c=!0;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(c=!1,l=!0),ERE_Property_Map_Search={init:function(){"1"==ere_search_map_vars.enable_filter_location&&(e(".ere-property-country-ajax",s).select2(),e(".ere-property-state-ajax",s).select2(),e(".ere-property-city-ajax",s).select2(),e(".ere-property-neighborhood-ajax",s).select2()),this.full_screen(),this.get_states_by_country(),e(".ere-property-country-ajax",s).on("change",function(){ERE_Property_Map_Search.get_states_by_country()}),this.get_cities_by_state(),e(".ere-property-state-ajax",s).on("change",function(){ERE_Property_Map_Search.get_cities_by_state()}),this.get_neighborhoods_by_city(),e(".ere-property-city-ajax",s).on("change",function(){ERE_Property_Map_Search.get_neighborhoods_by_city()}),e(".btn-status-filter",s).on("click",function(a){a.preventDefault();var t=e(this).data("value");e(this).parent().find("input").val(t),e(this).parent().find("button").removeClass("active"),e(this).addClass("active"),ERE_Property_Map_Search.change_price_on_status_change(t)}),e('select[name="status"]',s).on("change",function(a){a.preventDefault();var t=e(this).val();ERE_Property_Map_Search.change_price_on_status_change(t)}),this.execute_url_search(),e(".ere-sliderbar-filter.ere-sliderbar-price",s).on("register.again",function(){e(".ere-sliderbar-filter.ere-sliderbar-price",s).each(function(){var a=e(this);ERE_Property_Map_Search.set_slider_filter(a)})}),this.register_slider_filter(),this.set_slider_value(),this.property_map_paging(),this.search_map("map_only"),e(".other-features-wrap .btn-other-features",s).on("click",function(a){a.preventDefault(),e(".other-features-list",s).slideToggle(),e(this).toggleClass("show"),1==e(this).hasClass("show")?(e('input[name="features-search"]',s).attr("value","1"),e(this).find("i").removeClass("fa-chevron-down"),e(this).find("i").addClass("fa-chevron-up")):(e('input[name="features-search"]',s).attr("value","0"),e(this).find("i").removeClass("fa-chevron-up"),e(this).find("i").addClass("fa-chevron-down")),ERE_Property_Map_Search.search_map("map_and_content")}),e(".ere-sliderbar-filter.ere-sliderbar-price",s).on("register.again",function(){e(".ere-sliderbar-filter.ere-sliderbar-price",s).each(function(){var a=e(this);ERE_Property_Map_Search.set_slider_filter(a)})}),e(".ere-search-status-tab .btn-status-filter",s).on("click",function(){e(this).parent().find("input").val(e(this).data("value")),e(this).parent().find("button").removeClass("active"),e(this).addClass("active")}),e('select[name="type"], select[name="bedrooms"],select[name="bathrooms"] , select[name="garage"], select[name="label"],input[name="address"],input[name="title"],input[name="property_identity"], select[name="min-price"], select[name="max-price"],select[name="min-area"], select[name="max-area"],select[name="min-land-area"], select[name="min-land-area"], select[name="city"], select[name="country"], select[name="state"], select[name="neighborhood"]',s).on("change",function(){ERE_Property_Map_Search.search_map("map_and_content")}),e('input[name="other_features"]',s).on("change",function(){ERE_Property_Map_Search.search_map("map_and_content")})},get_states_by_country:function(){var a=e(".ere-property-country-ajax",s);if(a.length){var t=a.val();e.ajax({type:"POST",url:r,data:{action:"ere_get_states_by_country_ajax",country:t,type:1,is_slug:"1"},success:function(a){e(".ere-property-state-ajax",s).html(a);var t=e(".ere-property-state-ajax",s).attr("data-selected");void 0!==t&&e(".ere-property-state-ajax",s).val(t)}})}},get_cities_by_state:function(){var a=e(".ere-property-state-ajax",s);if(a.length){var t=a.val();e.ajax({type:"POST",url:r,data:{action:"ere_get_cities_by_state_ajax",state:t,type:1,is_slug:"1"},success:function(a){e(".ere-property-city-ajax",s).html(a);var t=e(".ere-property-city-ajax",s).attr("data-selected");void 0!==t&&e(".ere-property-city-ajax",s).val(t)}})}},get_neighborhoods_by_city:function(){var a=e(".ere-property-city-ajax",s);if(a.length){var t=a.val();e.ajax({type:"POST",url:r,data:{action:"ere_get_neighborhoods_by_city_ajax",city:t,type:1,is_slug:"1"},success:function(a){e(".ere-property-neighborhood-ajax",s).html(a);var t=e(".ere-property-neighborhood-ajax",s).attr("data-selected");void 0!==t&&e(".ere-property-neighborhood-ajax",s).val(t)}})}},execute_url_search:function(){e(".ere-advanced-search-btn",s).on("click",function(a){a.preventDefault();var t=e(this).closest(".search-properties-form"),r=t.data("href"),i=[],n="?";if(-1!==r.indexOf("?")&&(n="&"),e(".search-field",t).each(function(){var a=e(this),t=a.attr("name"),r=a.val();r!=a.data("default-value")&&(i[t]=r)}),e(".ere-sliderbar-filter",t).each(function(){var a=e(this),t=a.find(".min-input-request").attr("name"),r=a.find(".max-input-request").attr("name"),n=a.find(".min-input-request").val(),s=a.find(".max-input-request").val(),o=a.data("min-default"),l=a.data("max-default");n==o&&s==l||(i[t]=n,i[r]=s)}),void 0!==i["features-search"]){var s="";e('[name="other_features"]',t).each(function(){var a=e(this),t=a.attr("value");a.is(":checked")&&(s+=t+";")}),""!==s&&(s=s.substring("0",s.length-1),i.other_features=s)}if(i!==[])for(var o in i)i.hasOwnProperty(o)&&(n+=o+"="+i[o]+"&");n=n.substring("0",n.length-1),window.location.href=r+n})},set_slider_filter:function(e){var a,t,r=e,i=parseInt(r.attr("data-min-default")),n=parseInt(r.attr("data-max-default")),s=r.attr("data-min"),o=r.attr("data-max");r.find(".sidebar-filter").slider({min:i,max:n,range:!0,values:[s,o],slide:function(e,i){a=i.values[0],t=i.values[1],r.attr("data-min",a),r.attr("data-max",t),r.find("input.min-input-request").attr("value",a),r.find("input.max-input-request").attr("value",t),r.find("span").hasClass("not-format")?(r.find("span.min-value").html(a),r.find("span.max-value").html(t)):(r.find("span.min-value:not(.not-format)").html(ERE.number_format(a)),r.find("span.max-value:not(.not-format)").html(ERE.number_format(t)))},stop:function(e,a){ERE_Property_Map_Search.search_map("map_and_content")}})},register_slider_filter:function(){e(".ere-sliderbar-filter",s).each(function(){var a=e(this);ERE_Property_Map_Search.set_slider_filter(a)})},set_slider_value:function(){e(".ere-sliderbar-filter",s).each(function(){var a=e(this),t=a.attr("data-min-default"),r=a.attr("data-max-default"),i=a.attr("data-min"),n=a.attr("data-max"),s=(i-t)/(r-t)*100+"%",o=(n-i)/(r-t)*100+"%",l=(n-t)/(r-t)*100+"%";a.find(".ui-slider-range.ui-corner-all.ui-widget-header").css({left:s,width:o}),a.find(".ui-slider-handle.ui-corner-all.ui-state-default").css("left",s),a.find(".ui-slider-handle.ui-corner-all.ui-state-default:last-child").css("left",l)})},change_price_on_status_change:function(a){e.ajax({type:"POST",url:r,dataType:"json",data:{action:"ere_ajax_change_price_on_status_change",status:a,price_is_slider:i},success:function(a){a.slide_html?(e(".ere-sliderbar-price-wrap",s).html(a.slide_html),ERE_Property_Map_Search.register_slider_filter(),ERE_Property_Map_Search.set_slider_value()):(a.min_price_html&&e('select[name="min-price"]',s).html(a.min_price_html),a.max_price_html&&e('select[name="max-price"]',s).html(a.max_price_html)),ERE_Property_Map_Search.search_map("map_and_content")}})},full_screen:function(){if(e(".ere-search-map-properties").length>0){var a=e(window).outerHeight(),t=e("#wpadminbar").outerHeight();null==t&&(t=0);var r=a-t-e("header").outerHeight()-e("footer").outerHeight()-e(".wpadminbar").outerHeight();e(".ere-search-map-properties .ere-map-search").css("height",r),e(".ere-search-map-properties .ere-map-search .ere-map-result").css("height",r),e(".col-scroll-vertical").css({height:r,"overflow-y":"scroll","overflow-x":"hidden"});var i=e(".property-vertical-map-listing",".list-property-result-ajax"),n=e(".property-item",i);i.css("opacity",1),i.imagesLoaded(function(){ERE.set_item_effect(n,"hide"),n=e(".property-item",i),ERE.set_item_effect(n,"show")})}},property_map_paging:function(){!0,e(".paging-navigation",".property-search-map-paging-wrap").each(function(){e("a",e(this)).off("click").on("click",function(a){a.preventDefault();var t=e(this);ERE_Property_Map_Search.search_map("map_and_content",t)})})},property_map_paging_control:function(){e(".paging-navigation",".property-search-map-paging-wrap").each(function(){var a=e(this);0===a.find("a.next").length?a.addClass("next-disable"):a.removeClass("next-disable")})},search_map:function(i,d){var _,m,h,u,f,g,v,y,b,x,E,w,P,R,j,S,M,C,k,T,L=e(s),O=L.find(".ere-map-result").attr("id");f=L.find('input[name="title"]').val(),R=L.find('input[name="address"]').val(),m=L.find('select[name="city"]').val(),v=L.find('select[name="type"]').val(),void 0==(g=L.find('select[name="status"]').val())&&(g=L.find('input[name="status"]').val()),y=L.find('select[name="bedrooms"]').val(),b=L.find('select[name="bathrooms"]').val(),e(".ere-sliderbar-price",L).length?(x=L.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-min"),E=L.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-max")):(x=L.find('select[name="min-price"]').val(),E=L.find('select[name="max-price"]').val()),e(".ere-sliderbar-area",L).length?(w=L.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-min"),P=L.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-max")):(w=L.find('select[name="min-area"]').val(),P=L.find('select[name="max-area"]').val()),e(".ere-sliderbar-land-area",L).length?(C=L.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-min"),k=L.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-max")):(C=L.find('select[name="min-land-area"]').val(),k=L.find('select[name="max-land-area"]').val()),h=L.find('select[name="state"]').val(),_=L.find('select[name="country"]').val(),u=L.find('select[name="neighborhood"]').val(),M=L.find('select[name="label"]').val(),j=L.find('select[name="garage"]').val(),T=L.find('input[name="property_identity"]').val(),"1"==L.find('input[name="features-search"]').val()&&(S="",L.find(".other-features-list input[type=checkbox]:checked").each(function(){S+=e(this).val()+";"}),""!=S&&(S=S.substring(0,S.length-1)));var I=e("#ere_security_search_map").val(),z=e("#"+O),B=ere_search_map_vars.googlemap_default_zoom,H=ere_search_map_vars.not_found,D=ere_search_map_vars.clusterIcon,q=ere_search_map_vars.google_map_style,A=ere_search_map_vars.pin_cluster_enable,N={zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},scrollwheel:!1,scroll:{x:e(window).scrollLeft(),y:e(window).scrollTop()},zoom:parseInt(B),mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:c,fullscreenControl:!0,fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}};t=new InfoBox({disableAutoPan:!0,maxWidth:310,alignBottom:!0,pixelOffset:new google.maps.Size(-140,-55),zIndex:null,closeBoxMargin:"0 0 -16px -16px",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1});var Z=1;if(void 0!=d){var G=d.attr("href");Z=ERE.get_page_number_from_href(G)}e.ajax({dataType:"json",url:r,data:{action:"ere_property_search_map_ajax",title:f,address:R,country:_,state:h,city:m,neighborhood:u,type:v,status:g,bedrooms:y,bathrooms:b,min_price:x,max_price:E,min_area:w,max_area:P,label:M,garage:j,min_land_area:C,max_land_area:k,property_identity:T,features:S,search_type:i,paged:Z,item_amount:n,ere_security_search_map:I},beforeSend:function(){z.parents("div.ere-search-map-properties").find("#ere-map-loading").fadeIn()},success:function(r){if("map_and_content"==i){var n=e(".property-vertical-map-listing"),s=e(".list-property-result-ajax");if(!1===r.success)s.find(".title-result h2 .number-result").hide(),s.find(".title-result h2 .text-no-result").show(),s.find(".title-result h2 .text-result").hide(),s.find(".property-vertical-map-listing").hide(),s.find(".property-search-map-paging-wrap").hide();else{var c=e(".property-item",r.property_html),d=e(".property-search-map-paging-wrap",r.property_html);n.css("opacity",0),n.html(c),ERE.set_item_effect(c,"hide");var _=n.offset().top-30;e("html,body").animate({scrollTop:+_+"px"},500),n.css("opacity",1),n.imagesLoaded(function(){c=e(".property-item",n),ERE.set_item_effect(c,"show"),n.closest("div.list-property-result-ajax").find(".property-search-map-paging-wrap").html(d.html()),ERE_Property_Map_Search.property_map_paging(),ERE_Property_Map_Search.property_map_paging_control(),ERE.favorite(),ERE.tooltip(),ERE_Compare.register_event_compare()}),"0"!=c.length&&(s.find(".title-result h2 .number-result").html(r.total_post),s.find(".title-result h2 .number-result").show(),s.find(".title-result h2 .text-no-result").hide(),s.find(".title-result h2 .text-result").show(),s.find(".property-vertical-map-listing").show(),s.find(".property-search-map-paging-wrap").show())}}if(!0,(a=new google.maps.Map(document.getElementById(O),N)).set("scrollwheel",!1),google.maps.event.trigger(a,"resize"),!0===r.success&&r.properties)var m=r.properties.length;if(1==m)var h=google.maps.event.addListener(a,"bounds_changed",function(e){this.setZoom(parseInt(B)),google.maps.event.removeListener(h)});if(""!==q){var u=JSON.parse(q);a.setOptions({styles:u})}var f,g,v=new google.maps.LatLng("","");if(a.setCenter(v),a.setZoom(parseInt(B)),google.maps.event.addListener(a,"tilesloaded",function(){e("#ere-map-loading").fadeOut()}),!0===r.success){for(var y=0;y<o.length;y++)o[y].setMap(null);o=[],f=r.properties,g=a,e.each(f,function(e,a){var r=new google.maps.LatLng(a.lat,a.lng),i={url:a.marker_icon,size:new google.maps.Size(44,60),scaledSize:new google.maps.Size(44,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(7,27)},n=new google.maps.Marker({position:r,map:g,icon:i,draggable:!1,animation:google.maps.Animation.DROP}),s=a.data?a.data.post_title:a.title,l="";""!=a.image_url&&void 0!==a.image_url||(l='style="display: none;"');var c,p=document.createElement("div");p.className="marker-content clearfix",p.innerHTML='<div class="marker-content-inner clearfix"><div class = "item-thumb" '+l+'><a href="'+a.url+'"><img src="'+a.image_url+'" alt="'+s+'" style="width: 100px;"></a></div><div class="item-body"><a href="'+a.url+'" class="title-marker">'+s+'</a><div class="price-marker">'+a.price+'</div><div class="address-marker"><i class="fa fa-map-marker"></i>'+a.address+"</div></div></div>",google.maps.event.addListener(n,"click",(c=n,function(){var e=100/Math.pow(2,g.getZoom())||0,a=g.getProjection(),r=c.getPosition(),i=a.fromLatLngToPoint(r),n=new google.maps.Point(i.x,i.y-e),s=a.fromPointToLatLng(n);g.setCenter(s),setTimeout(function(){t.setContent(p),t.open(g,c)},300)})),o.push(n)}),a.fitBounds(o.reduce(function(e,a){return e.extend(a.getPosition())},new google.maps.LatLngBounds)),google.maps.event.trigger(a,"resize"),"1"==A&&new MarkerClusterer(a,o,{gridSize:60,styles:[{url:D,width:48,height:48,textColor:"#fff"}]}),l||p()}else z.empty().html('<div class="map-notfound">'+H+"</div>");z.closest("div.ere-search-map-properties").find("#ere-map-loading").fadeOut("slow")},error:function(){z.closest("div.ere-search-map-properties").find("#ere-map-loading").fadeOut("slow"),!0}})}};var p=function(){return e(".property-item",s).each(function(r){e(this).on("mouseenter",function(){a&&google.maps.event.trigger(o[r],"click")}),e(this).on("mouseleave",function(){t.open(null,null)})}),!1};e(document).ready(function(){ERE_Property_Map_Search.init()}),e(window).resize(function(){ERE_Property_Map_Search.full_screen()}),e(window).on("orientationchange",function(){ERE_Property_Map_Search.full_screen()}),e("body").keydown(function(a){return 35==a.which||34==a.which?(e(".col-scroll-vertical").animate({scrollTop:e(".col-scroll-vertical-inner").height()},"slow"),!1):36==a.which||33==a.which?(e(".col-scroll-vertical").animate({scrollTop:0},"slow"),!1):void 0})}(jQuery);