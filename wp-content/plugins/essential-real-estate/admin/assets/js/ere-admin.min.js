(function ($) {
    'use strict';
    $(document).ready(function () {
        $('.tips, .help_tip').tipTip({
            'attribute': 'data-tip',
            'fadeIn': 50,
            'fadeOut': 50,
            'delay': 200
        });

        //Manage the visibility of the taxonomy widgets which are normally shown on the right in admin panel (when adding properties)
        var residential_type_box_taxonomy ='#tagsdiv-property-residential-type';
        var residential_type_box_taxonomy_select = residential_type_box_taxonomy + ' select[name="tax_input[property-residential-type][]"]';
        var residential_type_box_post_select  ='#real_estate_property_residential_type select[name="real_estate_property_residential_type"]';
        $(residential_type_box_taxonomy).css("display", "none");
        $(residential_type_box_taxonomy_select).val($(residential_type_box_post_select).val());
        $(residential_type_box_post_select).change(function(){
            $(residential_type_box_taxonomy_select).val($(this).val());
        });

        var resid_furnished_type_box_taxonomy ='#tagsdiv-property-resid-furnished-type';
        var resid_furnished_type_box_taxonomy_select = resid_furnished_type_box_taxonomy + ' select[name="tax_input[property-resid-furnished-type][]"]';
        var resid_furnished_type_box_post_select  ='#real_estate_property_resid_furnished_type select[name="real_estate_property_resid_furnished_type"]';
        $(resid_furnished_type_box_taxonomy).css("display", "none");
        $(resid_furnished_type_box_taxonomy_select).val($(resid_furnished_type_box_post_select).val());
        $(resid_furnished_type_box_post_select).change(function(){
            $(resid_furnished_type_box_taxonomy_select).val($(this).val());
        });

        var commer_offices_box_taxonomy ='#tagsdiv-property-commer-offices';
        var commer_offices_box_taxonomy_select = commer_offices_box_taxonomy + ' select[name="tax_input[property-commer-offices][]"]';
        var commer_offices_box_post_select  ='#real_estate_property_commer_offices select[name="real_estate_property_commer_offices"]';
        $(commer_offices_box_taxonomy).css("display", "none");
        $(commer_offices_box_taxonomy_select).val($(commer_offices_box_post_select).val());
        $(commer_offices_box_post_select).change(function(){
            $(commer_offices_box_taxonomy_select).val($(this).val());
        });

        var commer_retail_box_taxonomy ='#tagsdiv-property-commer-retail';
        var commer_retail_box_taxonomy_select = commer_retail_box_taxonomy + ' select[name="tax_input[property-commer-retail][]"]';
        var commer_retail_box_post_select  ='#real_estate_property_commer_retail select[name="real_estate_property_commer_retail"]';
        $(commer_retail_box_taxonomy).css("display", "none");
        $(commer_retail_box_taxonomy_select).val($(commer_retail_box_post_select).val());
        $(commer_retail_box_post_select).change(function(){
            $(commer_retail_box_taxonomy_select).val($(this).val());
        });

        var commer_leisure_box_taxonomy ='#tagsdiv-property-commer-leisure';
        var commer_leisure_box_taxonomy_select = commer_leisure_box_taxonomy + ' select[name="tax_input[property-commer-leisure][]"]';
        var commer_leisure_box_post_select  ='#real_estate_property_commer_leisure select[name="real_estate_property_commer_leisure"]';
        $(commer_leisure_box_taxonomy).css("display", "none");
        $(commer_leisure_box_taxonomy_select).val($(commer_leisure_box_post_select).val());
        $(commer_leisure_box_post_select).change(function(){
            $(commer_leisure_box_taxonomy_select).val($(this).val());
        });
        
        var commer_industrial_box_taxonomy ='#tagsdiv-property-commer-industrial';
        var commer_industrial_box_taxonomy_select = commer_industrial_box_taxonomy + ' select[name="tax_input[property-commer-industrial][]"]';
        var commer_industrial_box_post_select  ='#real_estate_property_commer_industrial select[name="real_estate_property_commer_industrial"]';
        $(commer_industrial_box_taxonomy).css("display", "none");
        $(commer_industrial_box_taxonomy_select).val($(commer_industrial_box_post_select).val());
        $(commer_industrial_box_post_select).change(function(){
            $(commer_industrial_box_taxonomy_select).val($(this).val());
        });
        
        var commer_land_box_taxonomy ='#tagsdiv-property-commer-land';
        var commer_land_box_taxonomy_select = commer_land_box_taxonomy + ' select[name="tax_input[property-commer-land][]"]';
        var commer_land_box_post_select  ='#real_estate_property_commer_land select[name="real_estate_property_commer_land"]';
        $(commer_land_box_taxonomy).css("display", "none");
        $(commer_land_box_taxonomy_select).val($(commer_land_box_post_select).val());
        $(commer_land_box_post_select).change(function(){
            $(commer_land_box_taxonomy_select).val($(this).val());
        });

        var commer_other_box_taxonomy ='#tagsdiv-property-commer-other';
        var commer_other_box_taxonomy_select = commer_other_box_taxonomy + ' select[name="tax_input[property-commer-other][]"]';
        var commer_other_box_post_select  ='#real_estate_property_commer_other select[name="real_estate_property_commer_other"]';
        $(commer_other_box_taxonomy).css("display", "none");
        $(commer_other_box_taxonomy_select).val($(commer_other_box_post_select).val());
        $(commer_other_box_post_select).change(function(){
            $(commer_other_box_taxonomy_select).val($(this).val());
        });
        //----------------

        var css_class_wrap = '.ere-property-select-meta-box-wrap';
        var ajax_url = ere_admin_vars.ajax_url;
        var enable_filter_location=ere_admin_vars.enable_filter_location;
        if(enable_filter_location=='1')
        {
            $('.ere-property-country-ajax', css_class_wrap).select2();
            $('.ere-property-state-ajax', css_class_wrap).select2();
            $('.ere-property-city-ajax', css_class_wrap).select2();
            $('.ere-property-neighborhood-ajax', css_class_wrap).select2();
        }

        var ere_get_states_by_country = function () {
            var $this = $(".ere-property-country-ajax", css_class_wrap);
            var $property_state = $(".ere-property-state-ajax", css_class_wrap);
            var $is_slug = $property_state.attr('data-slug');
            if (typeof($is_slug) === 'undefined') {
                $is_slug='1';
            }
            if ($this.length && $property_state.length) {
                var selected_country = $this.val();
                $.ajax({
                    type: "POST",
                    url: ajax_url,
                    data: {
                        'action': 'ere_get_states_by_country_ajax',
                        'country': selected_country,
                        'type': 0,
                        'is_slug':$is_slug
                    },
                    beforeSend: function () {
                        $this.parent().children('.ere-loading').remove();
                        $this.parent().append('<span class="ere-loading"><i class="fa fa-spinner fa-spin"></i></span>');
                    },
                    success: function (response) {
                        $property_state.html(response);
                        var val_selected =$property_state.attr('data-selected');
                        if (typeof val_selected !== 'undefined') {
                            $property_state.val(val_selected);
                        }
                        $this.parent().children('.ere-loading').remove();
                    },
                    error: function () {
                        $this.parent().children('.ere-loading').remove();
                    },
                    complete: function () {
                        $this.parent().children('.ere-loading').remove();
                    }
                });
            }
        };
        ere_get_states_by_country();

        $(".ere-property-country-ajax", css_class_wrap).on('change', function () {
            ere_get_states_by_country();
        });

        var ere_get_cities_by_state = function () {
            var $this = $(".ere-property-state-ajax", css_class_wrap);
            var $property_city = $(".ere-property-city-ajax", css_class_wrap);
            var $is_slug = $property_city.attr('data-slug');
            if (typeof($is_slug) === 'undefined') {
                $is_slug='1';
            }
            if ($this.length && $property_city.length) {
                var selected_state = $this.val();
                $.ajax({
                    type: "POST",
                    url: ajax_url,
                    data: {
                        'action': 'ere_get_cities_by_state_ajax',
                        'state': selected_state,
                        'type': 0,
                        'is_slug':$is_slug
                    },
                    beforeSend: function () {
                        $this.parent().children('.ere-loading').remove();
                        $this.parent().append('<span class="ere-loading"><i class="fa fa-spinner fa-spin"></i></span>');
                    },
                    success: function (response) {
                        $property_city.html(response);
                        var val_selected = $property_city.attr('data-selected');
                        if (typeof val_selected !== 'undefined') {
                            $property_city.val(val_selected);
                        }
                        $this.parent().children('.ere-loading').remove();
                    },
                    error: function () {
                        $this.parent().children('.ere-loading').remove();
                    },
                    complete: function () {
                        $this.parent().children('.ere-loading').remove();
                    }
                });
            }
        };
        ere_get_cities_by_state();

        $(".ere-property-state-ajax", css_class_wrap).on('change', function () {
            ere_get_cities_by_state();
        });

        var ere_get_neighborhoods_by_city = function () {
            var $this = $(".ere-property-city-ajax", css_class_wrap);
            var $property_neighborhood = $(".ere-property-neighborhood-ajax", css_class_wrap);
            var $is_slug = $property_neighborhood.attr('data-slug');
            if (typeof($is_slug) === 'undefined') {
                $is_slug='1';
            }
            if ($this.length && $property_neighborhood.length) {
                var selected_city = $this.val();
                $.ajax({
                    type: "POST",
                    url: ajax_url,
                    data: {
                        'action': 'ere_get_neighborhoods_by_city_ajax',
                        'city': selected_city,
                        'type': 0,
                        'is_slug':$is_slug
                    },
                    beforeSend: function () {
                        $this.parent().children('.ere-loading').remove();
                        $this.parent().append('<span class="ere-loading"><i class="fa fa-spinner fa-spin"></i></span>');
                    },
                    success: function (response) {
                        $property_neighborhood.html(response);
                        var val_selected = $property_neighborhood.attr('data-selected');
                        if (typeof val_selected !== 'undefined') {
                            $property_neighborhood.val(val_selected);
                        }
                        $this.parent().children('.ere-loading').remove();
                    },
                    error: function () {
                        $this.parent().children('.ere-loading').remove();
                    },
                    complete: function () {
                        $this.parent().children('.ere-loading').remove();
                    }
                });
            }
        };
        ere_get_neighborhoods_by_city();

        $(".ere-property-city-ajax", css_class_wrap).on('change', function () {
            ere_get_neighborhoods_by_city();
        });
    });
})(jQuery);